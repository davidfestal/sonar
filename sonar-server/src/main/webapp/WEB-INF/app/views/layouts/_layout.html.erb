<% selected_section = controller.class::SECTION %>
<div id="container">
  <div id="hd">
    <%= render :partial => 'layouts/breadcrumb' %>
    <ol id="nav">
      <li><input type="text" autocomplete="off" size="15" name="search" id="projectSearch" onFocus="this.size=30;this.value='';autocompleteProjects('<%= ApplicationController.root_context -%>/api/resources?scopes=<%= Project::SCOPE_SET -%>&qualifiers=<%= Project::QUALIFIER_VIEW-%>,<%= Project::QUALIFIER_SUBVIEW-%>,<%= Project::QUALIFIER_PROJECT-%>', '<%= ApplicationController.root_context -%>/dashboard/index/', this, $('projectResults'));return true;" onBlur="javacript:this.size=15" value="Search"/><div id="projectResults" style="display:none"></div></li>
      <li>
        <a href="javascript:window.print()"><img src="<%= ApplicationController.root_context -%>/images/print.gif" alt="Print" title="Print" /></a>
        <% if @project %><a href="<%= url_for :overwrite_params => {:id => @project.key}-%>" id="permalink"><img src="<%= ApplicationController.root_context -%>/images/permalink.gif" alt="Permalink" title="Permalink" /></a><% end %>
      </li>
      <% if logged_in? %>
      <li>
      <img src="<%= ApplicationController.root_context -%>/images/user.gif"/><a href="<%= ApplicationController.root_context -%>/account/index"><%= current_user.name(true) -%></a>
      &raquo; <a href="<%= ApplicationController.root_context -%>/sessions/logout"><%=I18nHelper.trans_app_view("layouts.layout", "logout", "Log out")%></a>
      </li>
      <% else %>
      <li><a href="<%= ApplicationController.root_context -%>/sessions/new"><%=I18nHelper.trans_app_view("layouts.layout", "login", "Log in")%></a></li>
      <% end %>
      <li><a href="<%= ApplicationController.root_context -%>/profiles"><%=I18nHelper.trans_app_view("layouts.layout", "configuration", "Configuration")%></a></li>
    </ol>

  </div>
  <div id="body" class="with_sidebar">
     <div id="sb">
       <div id="sidebar">
        <ul>
        <% if selected_section==Navigation::SECTION_HOME %>
          <li class="<%= 'selected' if controller.controller_path=='filters' -%>"><a href="<%= ApplicationController.root_context -%>/filters/index"><%=I18nHelper.trans_app_view("layouts.layout", "filters", "Filters")%></a></li>
          <li class="<%= 'selected' if controller.controller_path=='reviews' -%>"><a href="<%= ApplicationController.root_context -%>/reviews/index"><%=I18nHelper.trans_app_view("layouts.layout", "reviews", "Reviews")%></a></li>
          <li class="<%= 'selected' if controller.controller_path=='dependencies' -%>"><a href="<%= ApplicationController.root_context -%>/dependencies/index"><%=I18nHelper.trans_app_view("layouts.layout", "dependencies", "Dependencies")%></a></li>

          <% controller.java_facade.getPages(Navigation::SECTION_HOME, nil, nil, nil).each do |page|
               selected=request.request_uri.include?("/plugins/home/#{page.getId()}") %>
          <li class="<%= 'selected' if selected -%>"><a href="<%= ApplicationController.root_context -%>/plugins/home/<%= page.getId() -%>"><%= page.getTitle(I18nHelper.java_locale)-%></a></li>
          <% end %>

        <% elsif (selected_section==Navigation::SECTION_RESOURCE) %>
          <% ActiveDashboard.user_dashboards(current_user).each do |active_dashboard| %>
            <li class="<%= 'selected' if @dashboard && controller.controller_path=='dashboard' &&  active_dashboard.dashboard_id==@dashboard.id -%>"><a href="<%= ApplicationController.root_context -%>/dashboard/index/<%= @project.id -%>?did=<%= active_dashboard.dashboard_id -%>"><%= active_dashboard.dashboard.name -%></a></li>
          <% end %>
          <li class="<%= 'selected' if request.request_uri.include?('/components/index') -%>"><a href="<%= ApplicationController.root_context -%>/components/index/<%= @project.id -%>"><%=I18nHelper.trans_app_view("layouts.layout", "components", "Components")%></a></li>
          <li class="<%= 'selected' if request.request_uri.include?('/drilldown/violations') -%>"><a href="<%= ApplicationController.root_context -%>/drilldown/violations/<%= @project.id -%>"><%=I18nHelper.trans_app_view("layouts.layout", "violations_drilldown", "Violations drilldown")%></a></li>
          <li class="<%= 'selected' if controller.controller_path=='timemachine' -%>"><a href="<%= ApplicationController.root_context -%>/timemachine/index/<%= @project.id -%>"><%=I18nHelper.trans_app_view("layouts.layout", "time_machine", "Time machine")%></a></li>
          <% controller.java_facade.getPages(Navigation::SECTION_RESOURCE, @project.scope, @project.qualifier, @project.language).each do |page| %>
          <li class="<%= 'selected' if request.request_uri.include?("page=#{page.getId()}") -%>"><a href="<%= ApplicationController.root_context -%>/plugins/resource/<%= @project.id-%>?page=<%= page.getId() -%>"><%= page.getTitle(I18nHelper.java_locale) %></a></li>
          <% end %>
          <% if has_role?(:admin, @project) && @project.set? %>
            <li class="h2">System</li>
            <% if (@project.project? || @project.module?) %>
              <li class="<%= 'selected' if request.request_uri.include?('/project/settings') -%>"><a href="<%= ApplicationController.root_context -%>/project/settings/<%= @project.id -%>"><%=I18nHelper.trans_app_view("layouts.layout", "settings", "Settings")%></a></li>
            <% end %>
            <% if (@project.project? || @project.view? || @project.subview?) %>
              <li class="<%= 'selected' if request.request_uri.include?('/project_roles') -%>"><a href="<%= ApplicationController.root_context -%>/project_roles/index?resource=<%= @project.id -%>"><%=I18nHelper.trans_app_view("layouts.layout", "project_roles", "Project roles")%></a></li>
            <% end %>
          <% end %>

        <% elsif selected_section==Navigation::SECTION_CONFIGURATION %>

          <li class="<%= 'selected' if request.request_uri.include?('/profiles') || request.request_uri.include?('/rules_configuration') -%>"><a href="<%= ApplicationController.root_context -%>/profiles"><%=I18nHelper.trans_app_view("layouts.layout", "quality_profiles", "Quality profiles")%></a></li>
            <% if is_admin? %>
              <li class="<%= 'selected' if controller.controller_path=='event_categories' -%>"><a href="<%= ApplicationController.root_context -%>/event_categories/index"><%=I18nHelper.trans_app_view("layouts.layout", "event_categories", "Event categories")%></a></li>
              <li class="<%= 'selected' if controller.controller_path=='metrics' -%>"><a href="<%= ApplicationController.root_context -%>/metrics/index"><%=I18nHelper.trans_app_view("layouts.layout", "manual_metrics", "Manual metrics")%></a></li>
              <li class="<%= 'selected' if controller.controller_path=='admin_filters' -%>"><a href="<%= ApplicationController.root_context -%>/admin_filters/index"><%=I18nHelper.trans_app_view("layouts.layout", "default_filters", "Default filters")%></a></li>
              <li class="<%= 'selected' if controller.controller_path=='admin_dashboards' -%>"><a href="<%= ApplicationController.root_context -%>/admin_dashboards/index"><%=I18nHelper.trans_app_view("layouts.layout", "default_dashboards", "Default dashboards")%></a></li>                  
              <li class="<%= 'selected' if controller.controller_path=='account' -%>"><a href="<%= ApplicationController.root_context -%>/account/index"><%=I18nHelper.trans_app_view("layouts.layout", "my_profile", "My profile")%></a></li>
              <% controller.java_facade.getPages(Navigation::SECTION_CONFIGURATION, nil,nil, nil).each do |page| %>
                <li class="<%= 'selected' if request.request_uri.include?("plugins/configuration/#{page.getId()}") -%>"><a href="<%= ApplicationController.root_context -%>/plugins/configuration/<%= page.getId() -%>"><%= page.getTitle(I18nHelper.java_locale) %></a></li>
              <% end %>

              <li class="h2"><%=I18nHelper.trans_app_view("layouts.layout", "security", "Security")%></li>
              <li class="<%= 'selected' if request.request_uri.include?('/users') -%>"><a href="<%= ApplicationController.root_context -%>/users"><%=I18nHelper.trans_app_view("layouts.layout", "users", "Users")%></a></li>
              <li class="<%= 'selected' if request.request_uri.include?('/groups') -%>"><a href="<%= ApplicationController.root_context -%>/groups/index"><%=I18nHelper.trans_app_view("layouts.layout", "groups", "Groups")%></a></li>
              <li class="<%= 'selected' if request.request_uri.include?('/roles/global') -%>"><a href="<%= ApplicationController.root_context -%>/roles/global"><%=I18nHelper.trans_app_view("layouts.layout", "global_roles", "Global roles")%></a></li>
              <li class="<%= 'selected' if request.request_uri.include?('/roles/projects') -%>"><a href="<%= ApplicationController.root_context -%>/roles/projects"><%=I18nHelper.trans_app_view("layouts.layout", "project_roles", "Project roles")%></a></li>

              <li class="h2"><%=I18nHelper.trans_app_view("layouts.layout", "system", "System")%></li>
              <li class="<%= 'selected' if request.request_uri.include?('/settings') -%>"><a href="<%= ApplicationController.root_context -%>/settings/index"><%=I18nHelper.trans_app_view("layouts.layout", "settings", "Settings")%></a></li>
              <li class="<%= 'selected' if controller.controller_path=='backup' -%>"><a href="<%= ApplicationController.root_context -%>/backup"><%=I18nHelper.trans_app_view("layouts.layout", "backup", "Backup")%></a></li>
              <li class="<%= 'selected' if controller.controller_path=='system' -%>"><a href="<%= ApplicationController.root_context -%>/system"><%=I18nHelper.trans_app_view("layouts.layout", "system_info", "System Info")%></a></li>
              <% update_center_activated = controller.java_facade.getConfigurationValue('sonar.updatecenter.activate') || 'true';
              if update_center_activated=='true' %>
                <li class="<%= 'selected' if controller.controller_path=='updatecenter' -%>"><a href="<%= ApplicationController.root_context -%>/updatecenter"><%=I18nHelper.trans_app_view("layouts.layout", "update_center", "Update Center")%></a></li>
              <% end %>
            <% end %>

        <% end %>
        </ul>
        <div id="logo"><center><a href="http://www.sonarsource.org/"><%= image_tag('sonar.png', :alt => 'Embrace Quality', :class => 'png') -%></a></center></div>
        </div>

      <% if @sidebar %><div id="sidebarconf"><%= render :partial => @sidebar %></div><% else %><div id="sidebarconf" class="hidden"> </div><% end %>

     </div>
     <div id="content">
       <% if @project %><div class="print"><h2><%= @project.name(true) %></h2></div><% end %>
       <div class="error" id="error" style="display:none"><span id="errormsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$('error').hide();return false;">hide</a>]</div>
       <div class="notice" id="info" style="display:none"><span id="infomsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$('info').hide();return false;">hide</a>]</div>
       <div class="warning" id="warning" style="display:none"><span id="warningmsg"></span> &nbsp;&nbsp;[<a href="#" onclick="javascript:$('warning').hide();return false;">hide</a>]</div>
       <%= yield %>
     </div>
  </div>
</div>

<% unless params[:hd]=='false' %>
<div id="ft">
<% controller.java_facade.getWebFooters().each do |footer| %>
<% if footer.getHtml() %><div><%= footer.getHtml().to_s %></div><% end %>
<% end %>
<div id="ftlinks">Powered by <a href="http://www.sonarsource.com" target="SonarSource" class="external">SonarSource</a> - Open Source <a href="http://www.sonarsource.org/documentation/license/" target="license" class="external">LGPL</a> - v.<%= sonar_version -%> - <a href="http://sonar-plugins.codehaus.org" class="external" target="plugins">Plugins</a> - <a href="http://sonar.codehaus.org/documentation" class="external" target="sonar_doc" class="external">Documentation</a> - <a href="http://sonar.codehaus.org/support/" target="support" class="external">Ask a question</a> - <a href="http://jira.codehaus.org/browse/SONAR" target="issuetracker" class="external">Bug/feature request</a></div>
</div>
<% end %>
